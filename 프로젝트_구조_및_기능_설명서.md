# 🎯 Tactics SRPG - 프로젝트 구조 및 기능 설명서

## 📋 프로젝트 개요

이 문서는 Godot 4.4 엔진으로 제작된 이소메트릭 턴제 전략 RPG 게임의 전체 구조와 각 파일별 기능을 상세히 설명합니다.

---

## 🗂️ 전체 파일 구조

```
tactics/
├── scenes/              # 게임 씬 관련 파일
│   ├── BattleGrid.gd    # 게임 맵 그리드 시스템
│   ├── BattleScene.gd   # 메인 전투 컨트롤러
│   └── BattleScene.tscn # 전투 씬 레이아웃
├── scripts/             # 게임 로직 스크립트
│   ├── Character.gd     # 캐릭터 클래스 시스템
│   ├── ClassChangeDialog.gd  # 클래스 체인지 UI
│   ├── GameData.gd      # 게임 데이터 저장소
│   └── GameManager.gd   # 게임 상태 관리자
├── project.godot        # Godot 프로젝트 설정
├── README.md           # 게임 플레이 가이드
└── 기획250627.md       # 게임 기획서
```

---

## 🎮 시스템별 기능 분석

### 1. 📍 **BattleGrid.gd** - 게임 맵 시스템

전투가 벌어지는 맵의 그리드 시스템을 담당하는 핵심 클래스입니다.

#### 🎯 주요 역할
- 50x35 크기의 대형 이소메트릭 맵 생성
- 8가지 지형 타입과 높이 시스템 관리
- 마우스 클릭을 통한 타일 선택 처리
- 캐릭터 이동 시 시각적 하이라이트 표시

#### 🔧 핵심 함수들

**`generate_test_map()`** - 맵 생성
```gdscript
# 랜덤 노이즈 기반으로 자연스러운 높이 맵 생성
# 높이에 따라 지형 타입 자동 결정
# -1(늪/평지) ~ 10+(험준한 산) 범위의 고저차
```

**`_unhandled_input(event)`** - 마우스 입력 처리
```gdscript
# 마우스 클릭 위치를 그리드 좌표로 변환
# 유효한 타일 클릭 시 tile_clicked 신호 발생
# BattleScene에 클릭 정보 전달
```

**`grid_to_local(grid_pos)` / `local_to_grid(local_pos)`** - 좌표 변환
```gdscript
# 그리드 좌표 ↔ 화면 좌표 변환
# 이소메트릭 투영 계산 담당
```

**`highlight_tiles(positions, color)`** - 타일 하이라이트
```gdscript
# 이동/공격 가능 범위를 색깔로 표시
# 녹색: 이동 가능, 빨간색: 공격 가능, 보라색: 스킬 범위
```

#### 🌍 지형 시스템
- **Plain**: 기본 지형 (이동 코스트 1)
- **Mountain**: 고지대 (이동 코스트 3, 전투 보너스)
- **Forest**: 숲 (이동 코스트 2, 은신 효과)
- **Swamp**: 늪 (이동 코스트 4, 속도 감소)
- **Desert**: 사막 (이동 코스트 3, 목마름 효과)
- **Rocky**: 바위지대 (이동 코스트 2, 투사 보너스)
- **Burning**: 불타는 땅 (이동 코스트 2, 화염 데미지)
- **Frozen**: 얼어붙은 땅 (이동 코스트 2, 미끄러짐 위험)

---

### 2. ⚔️ **BattleScene.gd** - 전투 컨트롤러

게임의 메인 전투 흐름을 제어하는 중앙 관리자입니다.

#### 🎯 주요 역할
- 턴제 전투 시스템 운영
- 캐릭터 선택 및 액션 처리
- UI 업데이트 및 카메라 조작
- 게임 상태 관리

#### 🔧 핵심 함수들

**`_input(event)`** - 입력 처리
```gdscript
# 마우스 클릭으로 캐릭터 선택
# 카메라 줌 (마우스 휠)
# 액션 모드에 따른 분기 처리
```

**`handle_character_selection(mouse_pos)`** - 캐릭터 선택
```gdscript
# 마우스 위치에서 가장 가까운 캐릭터 찾기
# 선택 시각화 (화살표, 원형 링)
# 이동 범위 자동 표시
```

**`select_character(character)`** - 캐릭터 활성화
```gdscript
# 기존 선택 해제
# 새 캐릭터 선택 표시 생성
# UI 정보 업데이트
# 이동 가능 범위 하이라이트
```

**`_on_tile_clicked(grid_pos, terrain_name)`** - 타일 클릭 처리
```gdscript
# 현재 액션 모드에 따른 분기:
# - MOVE: 캐릭터 이동 실행
# - ATTACK: 공격 대상 선택
# - SKILL: 스킬 사용
```

**`handle_camera_movement(delta)`** - 카메라 조작
```gdscript
# WASD/화살표 키로 카메라 이동
# 화면 가장자리 마우스로 스크롤
# 부드러운 카메라 이동 처리
```

#### 🎮 액션 모드 시스템
- **NONE**: 기본 상태 (캐릭터 선택 가능)
- **MOVE**: 이동 모드 (녹색 타일 클릭으로 이동)
- **ATTACK**: 공격 모드 (빨간색 타일 클릭으로 공격)
- **SKILL**: 스킬 모드 (보라색 타일 클릭으로 스킬 사용)

---

### 3. 👤 **Character.gd** - 캐릭터 시스템

게임 내 모든 캐릭터(플레이어/적)의 데이터와 행동을 관리합니다.

#### 🎯 주요 역할
- 캐릭터 스탯 및 성장 관리
- 클래스 체인지 시스템
- 전투 상태 추적
- 스킬 학습 및 사용

#### 🔧 핵심 함수들

**`initialize_character(data)`** - 캐릭터 초기화
```gdscript
# 이름, 클래스, 레벨 설정
# 기본 스탯 및 적성 적용
# 위치 및 초기 상태 설정
```

**`calculate_current_stats()`** - 스탯 계산
```gdscript
# 기본 스탯 + 클래스 보너스
# 레벨에 따른 성장 적용
# 장비 효과 반영 (추후 구현)
```

**`level_up()`** - 레벨업 처리
```gdscript
# 성장률 기반 랜덤 스탯 증가
# 새로운 스킬 습득 가능성 체크
# 체력/마나 최대치 재계산
```

**`attempt_class_change(target_class)`** - 클래스 체인지
```gdscript
# 전직 조건 확인 (적성, 상위 클래스)
# 성공 시 스킬 및 스탯 재계산
# 실패 시 오류 메시지 출력
```

**`take_damage(damage, damage_type)`** - 데미지 처리
```gdscript
# 방어력 및 저항력 적용
# 상태이상 효과 계산
# 체력 감소 및 사망 체크
```

#### 📊 스탯 시스템
- **STR** (힘): 물리 공격력에 영향
- **DEF** (방어): 물리 방어력, 체력 증가
- **DEX** (기술): 명중률, 회피율에 영향
- **AGI** (민첩): 턴 순서, 이동력에 영향
- **INT** (지능): 마법 공격력, 마나량에 영향
- **RES** (저항): 마법 방어력에 영향

#### 🎭 적성 시스템
- **S급**: 150% 성능 (최고 등급)
- **A급**: 130% 성능
- **B급**: 110% 성능
- **C급**: 100% 성능 (기본)
- **D급**: 80% 성능 (부적합)

---

### 4. 🔄 **ClassChangeDialog.gd** - 클래스 체인지 UI

캐릭터의 클래스 변경을 위한 대화창 시스템입니다.

#### 🎯 주요 역할
- 전직 가능한 클래스 목록 표시
- 클래스별 상세 정보 제공
- 전직 조건 확인 및 실행

#### 🔧 핵심 함수들

**`show_for_character(character)`** - 대화창 표시
```gdscript
# 특정 캐릭터의 전직 가능 클래스 확인
# 현재 적성과 요구 조건 비교
# 대화창 팝업 및 정보 업데이트
```

**`find_available_classes()`** - 전직 가능 클래스 탐색
```gdscript
# GameData의 모든 클래스 순회
# 전직 조건 확인 (상위 클래스, 적성)
# 리스트에 가능한 클래스만 추가
```

**`show_class_details(class_name)`** - 클래스 상세 정보
```gdscript
# 클래스 설명 및 특징 표시
# 요구 적성과 현재 적성 비교
# 성장률 및 스킬 정보 제공
```

**`_on_confirm_pressed()`** - 전직 실행
```gdscript
# 선택된 클래스로 전직 실행
# 캐릭터 데이터 업데이트
# 성공 메시지 표시
```

---

### 5. 📊 **GameData.gd** - 게임 데이터 저장소

게임의 모든 정적 데이터를 관리하는 싱글톤 클래스입니다.

#### 🎯 주요 역할
- 클래스, 스킬, 지형 데이터 정의
- 환경 상호작용 룰 관리
- 전직 조건 검증
- 데이터 일관성 보장

#### 🔧 핵심 데이터 구조

**`CLASSES`** - 클래스 정보
```gdscript
{
    "Soldier": {
        "parent": null,  # 기본 클래스
        "weapons": ["Sword"],
        "skills": ["Slash", "Guard"],
        "aptitude": {},  # 요구 적성 없음
        "stat_growth": {"STR": 0.7, "DEF": 0.6, ...}
    },
    "Knight": {
        "parent": "Soldier",  # Soldier에서 전직 가능
        "weapons": ["Sword", "Lance"],
        "skills": ["Slash", "Guard", "Charge", "Parry"],
        "aptitude": {"STR": "S"},  # STR S급 요구
        "stat_growth": {"STR": 0.8, "DEF": 0.8, ...}
    }
}
```

**`SKILLS`** - 스킬 정보
```gdscript
{
    "Fireball": {
        "type": "Magic",
        "element": "Fire",
        "power": 22,
        "range": 3,
        "effect": "CreateBurningGround"
    }
}
```

**`TERRAINS`** - 지형 정보
```gdscript
{
    "Forest": {
        "height": 0,
        "move_cost": 2,
        "effect": "Hide",
        "state": "Normal"
    }
}
```

**`ENVIRONMENT_INTERACTIONS`** - 환경 상호작용
```gdscript
{
    "Fire_Dry": {
        "multiplier": 1.5,
        "effect": "CreateBurningGround"
    },
    "Lightning_Wet": {
        "multiplier": 1.3,
        "effect": "Electrify"
    }
}
```

#### 🔧 핵심 함수들

**`can_class_change(character_data, target_class)`** - 전직 가능성 확인
```gdscript
# 상위 클래스 관계 확인
# 요구 적성과 현재 적성 비교
# 레벨 조건 등 추가 요구사항 체크
```

**`get_terrain_skill_interaction(terrain_name, skill_name)`** - 환경 상호작용
```gdscript
# 지형 상태와 스킬 속성 매칭
# 데미지 배율 및 추가 효과 반환
# 지형 변화 효과 계산
```

---

### 6. 🎲 **GameManager.gd** - 게임 상태 관리자

게임의 전체적인 상태와 턴 진행을 관리하는 중앙 컨트롤러입니다.

#### 🎯 주요 역할
- 턴제 전투 흐름 제어
- 외부 전황 시뮬레이션
- 정보 시스템 관리
- 데미지 계산 및 환경 효과

#### 🔧 핵심 함수들

**`start_battle(player_chars, enemy_chars)`** - 전투 시작
```gdscript
# 참가 캐릭터 설정
# 민첩도 기반 턴 순서 결정
# 전투 상태 초기화
```

**`next_turn()`** - 턴 진행
```gdscript
# 플레이어 턴 → 적 턴 → 환경 턴 순환
# 턴 카운터 증가
# 각 페이즈별 특수 처리
```

**`simulate_external_events(delta)`** - 외부 전황 시뮬레이션
```gdscript
# 실시간으로 외부 상황 변화
# 랜덤 이벤트 생성 (증원, 지원, 날씨 변화)
# 정보의 신선도 감소
```

**`calculate_damage(attacker, defender, skill_name, terrain_name)`** - 데미지 계산
```gdscript
# 기본 공격력 - 방어력 계산
# 지형 효과 적용 (고지대 보너스 등)
# 적성 보너스 적용
# 환경 상호작용 효과
```

**`acquire_intelligence(info_type, info_data)`** - 정보 획득
```gdscript
# 정찰, 스파이 등으로 얻은 정보 저장
# 정보 신선도 초기화
# 빠른 전투 종료 시 정보 유지 이점
```

#### 🎮 게임 상태 시스템
- **MENU**: 메뉴 화면
- **BATTLE_PREPARATION**: 전투 준비
- **BATTLE**: 전투 진행 중
- **BATTLE_END**: 전투 종료
- **CHARACTER_MENU**: 캐릭터 관리

#### ⏰ 턴 페이즈 시스템
- **PLAYER_TURN**: 플레이어 행동
- **ENEMY_TURN**: 적군 행동
- **ENVIRONMENT_TURN**: 환경 변화 처리

---

## 🎯 시스템 간 상호작용

### 1. 캐릭터 선택 → 이동 흐름
```
BattleScene._input() → handle_character_selection() 
→ select_character() → BattleGrid.highlight_tiles()
→ 이동 범위 시각화
```

### 2. 타일 클릭 → 이동 실행 흐름
```
BattleGrid._unhandled_input() → emit tile_clicked 신호
→ BattleScene._on_tile_clicked() → execute_move()
→ 캐릭터 위치 업데이트
```

### 3. 클래스 체인지 흐름
```
ClassChangeDialog.show_for_character() 
→ GameData.can_class_change() → Character.change_class()
→ 스탯 재계산 및 스킬 업데이트
```

### 4. 데미지 계산 흐름
```
BattleScene.execute_attack() → GameManager.calculate_damage()
→ GameData.get_terrain_skill_interaction()
→ Character.take_damage()
```

---

## 🚀 확장 가능한 설계

### 1. 모듈식 구조
- 각 시스템이 독립적으로 동작
- 신호(Signal) 기반 느슨한 결합
- 새로운 기능 추가 시 기존 코드 영향 최소화

### 2. 데이터 기반 설계
- GameData.gd에서 모든 게임 밸런스 관리
- 코드 수정 없이 데이터만 변경으로 밸런싱 가능
- 새로운 클래스/스킬/지형 쉽게 추가 가능

### 3. 상태 관리 패턴
- GameManager에서 중앙집중식 상태 관리
- 턴제 시스템의 복잡한 상태 변화 체계적 처리
- 저장/불러오기 시스템 구현 용이

---

## 🎨 시각적 특징

### 1. 이소메트릭 투영
- 45도 각도의 3D 느낌 2D 그래픽
- 전략적 시점에서 맵 전체 조망 가능
- 높이 차이를 효과적으로 표현

### 2. 색상 기반 정보 전달
- 지형별 고유 색상으로 즉각적 인식
- 하이라이트 시스템으로 가능한 행동 안내
- 캐릭터 진영 구분 (파란색/빨간색)

### 3. 동적 UI 업데이트
- 실시간 캐릭터 정보 표시
- 턴 정보 및 상태 변화 추적
- 직관적인 버튼 및 인터페이스

---

## 🔧 디버깅 및 개발 도구

### 1. 로깅 시스템
- 각 함수의 실행 과정 상세 로그
- 마우스 클릭 및 좌표 변환 추적
- 오류 발생 시 원인 파악 용이

### 2. 시각적 디버깅
- 그리드 좌표 및 높이 정보 표시
- 캐릭터 선택 상태 시각화
- 이동/공격 범위 하이라이트

### 3. 개발자 명령어
- 카메라 조작 (WASD, 마우스 휠)
- 화면 가장자리 스크롤 토글 (E키)
- 턴 강제 종료 및 상태 변경

---

이 문서를 통해 프로젝트의 전체 구조와 각 파일의 역할을 명확히 이해하실 수 있을 것입니다. 각 시스템은 독립적이면서도 유기적으로 연결되어 복잡한 전략 게임을 구현하고 있습니다. 